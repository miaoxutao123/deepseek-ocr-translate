import{u as L,r as u,i as J,c as x,o as n,k as C,m as _,b as r,l as W,w as l,d as a,e as X,g as i,h as o,t as b,F as $,n as q,E as m,p as R}from"./index-BEEL7eZv.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={key:0,style:{"margin-top":"20px"}},K={style:{"margin-bottom":"10px"}},Q={style:{display:"flex","justify-content":"space-between"}},Y={__name:"OCR",setup(Z){const I=X(),S=L(),g=u(null),p=u(!1),f=u(null),d=u(null),s=u(""),w=u(0),c=u(0),v=u(""),T=J(()=>c.value===0?0:Math.round(w.value/c.value*100)),E=t=>{g.value=t.raw},N=async()=>{if(!g.value){m.warning("请选择文件");return}p.value=!0,s.value="正在上传文件...",w.value=0,c.value=0,f.value=null,v.value="";try{const t=await R.uploadFile(g.value);d.value=t.history_id,s.value="文件已上传，后台处理中...",m.success("文件已上传，正在后台处理，您可以关闭此页面"),y()}catch(t){console.error("Upload error:",t),s.value="上传失败",v.value="exception",m.error("OCR处理失败: "+(t.message||"未知错误")),p.value=!1}},y=async()=>{if(d.value)try{const t=await R.getStatus(d.value);if(console.log("OCR Status:",t),t.status==="COMPLETED"){const e=await R.getResult(d.value);f.value=e,s.value="识别完成！",v.value="success",p.value=!1,m.success("OCR识别完成")}else t.status==="FAILED"?(s.value="处理失败: "+(t.error_message||"未知错误"),v.value="exception",p.value=!1,m.error("OCR处理失败: "+(t.error_message||"未知错误"))):t.status==="PROCESSING"?(s.value="正在处理中...",t.total_pages&&(c.value=t.total_pages),setTimeout(y,2e3)):t.status==="PENDING"&&(s.value="等待处理...",setTimeout(y,2e3))}catch(t){console.error("Poll status error:",t),p.value&&setTimeout(y,3e3)}},V=()=>{I.push(`/translate/${d.value}`)};return(t,e)=>{const A=a("router-link"),F=a("el-alert"),h=a("upload-filled"),B=a("el-icon"),D=a("el-upload"),O=a("el-button"),G=a("el-progress"),k=a("el-card"),U=a("el-input");return n(),x("div",null,[W(S).hasApiConfig?_("",!0):(n(),C(F,{key:0,title:"请先配置API密钥",type:"warning",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},{default:l(()=>[e[1]||(e[1]=i(" 请前往 ",-1)),r(A,{to:"/settings"},{default:l(()=>[...e[0]||(e[0]=[i("API配置",-1)])]),_:1}),e[2]||(e[2]=i(" 页面配置OCR和翻译服务的API密钥 ",-1))]),_:1})),r(k,null,{header:l(()=>[...e[3]||(e[3]=[o("h3",null,"上传文件进行OCR识别",-1)])]),default:l(()=>[r(D,{drag:"","auto-upload":!1,"on-change":E,limit:1,accept:".png,.jpg,.jpeg,.pdf,.docx,.txt"},{tip:l(()=>[...e[4]||(e[4]=[o("div",{class:"el-upload__tip"}," 支持 PNG、JPG、PDF、Word、TXT 格式，文件大小不超过 1GB ",-1)])]),default:l(()=>[r(B,{class:"el-icon--upload"},{default:l(()=>[r(h)]),_:1}),e[5]||(e[5]=o("div",{class:"el-upload__text"},[i(" 将文件拖到此处，或"),o("em",null,"点击上传")],-1))]),_:1}),g.value?(n(),x("div",H,[r(O,{type:"primary",onClick:N,loading:p.value},{default:l(()=>[...e[6]||(e[6]=[i(" 开始识别 ",-1)])]),_:1},8,["loading"])])):_("",!0),p.value&&s.value?(n(),C(k,{key:1,style:{"margin-top":"20px"}},{default:l(()=>[o("div",K,[o("strong",null,b(s.value),1)]),c.value>0?(n(),C(G,{key:0,percentage:T.value,status:v.value},null,8,["percentage","status"])):_("",!0)]),_:1})):_("",!0)]),_:1}),f.value?(n(),C(k,{key:1,style:{"margin-top":"20px"}},{header:l(()=>[o("div",Q,[e[8]||(e[8]=o("h3",null,"OCR结果",-1)),r(O,{type:"primary",onClick:V},{default:l(()=>[...e[7]||(e[7]=[i("翻译此文档",-1)])]),_:1})])]),default:l(()=>[(n(!0),x($,null,q(f.value.pages,(P,M)=>(n(),x("div",{key:M,class:"ocr-result"},[o("h4",null,"第 "+b(P.page_number)+" 页",1),r(U,{type:"textarea",modelValue:P.text,"onUpdate:modelValue":j=>P.text=j,rows:10,readonly:""},null,8,["modelValue","onUpdate:modelValue"])]))),128))]),_:1})):_("",!0)])}}},le=z(Y,[["__scopeId","data-v-52d704fb"]]);export{le as default};
